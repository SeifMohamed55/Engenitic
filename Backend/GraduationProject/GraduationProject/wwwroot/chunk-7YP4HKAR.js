import{a as M}from"./chunk-KCRSIWVY.js";import{a as N,b as g,c as V,d as j,e as q,f as w,h as $,j as G,m as O,t as A}from"./chunk-W3D5FJDG.js";import{l as k,n as U}from"./chunk-T3YITE6W.js";import{c as F,d as D,g as T}from"./chunk-CGPJEUNO.js";import{j as R,r as E}from"./chunk-3CPSLGPY.js";import{Ab as s,Bb as c,Eb as L,Ib as _,Jb as y,R as x,Sb as C,Tb as m,Xa as l,bb as v,gb as I,ha as f,ia as h,j as b,lb as d,sb as a,zb as r}from"./chunk-YOS4OKYA.js";function B(n,e){n&1&&(r(0,"p",17),m(1," the email entity is required "),s())}function H(n,e){n&1&&(r(0,"p",17),m(1," email is not valid "),s())}function W(n,e){if(n&1&&(r(0,"div"),d(1,B,2,0,"p",16)(2,H,2,0,"p",16),s()),n&2){let t,i,o=y();l(),a("ngIf",(t=o.loginForm.get("email"))==null?null:t.getError("required")),l(),a("ngIf",(i=o.loginForm.get("email"))==null?null:i.getError("email"))}}function z(n,e){n&1&&(r(0,"p",17),m(1," the password entity is required "),s())}function J(n,e){n&1&&(r(0,"p",17),m(1," password must be more than 6 characters "),s())}function K(n,e){if(n&1&&(r(0,"div"),d(1,z,2,0,"p",16)(2,J,2,0,"p",16),s()),n&2){let t,i,o=y();l(),a("ngIf",(t=o.loginForm.get("password"))==null?null:t.getError("required")),l(),a("ngIf",(i=o.loginForm.get("password"))==null?null:i.getError("minlength"))}}var P=class n{constructor(e,t,i){this._UserService=e;this.toastr=t;this._Router=i}destroy$=new b;destroyImage$=new b;loginResponse;buttonDisabled=!1;loginForm=new q({email:new w("",[g.email,g.required]),password:new w("",[g.minLength(6),g.required]),rememberMe:new w(!1,[g.required])});ngOnInit(){typeof window<"u"&&window.addEventListener("message",this.receiveMessage.bind(this),!1)}ngOnDestroy(){typeof window<"u"&&window.removeEventListener("message",this.receiveMessage.bind(this),!1),this.destroy$.next(),this.destroy$.complete(),this.destroyImage$.next(),this.destroyImage$.complete()}handleData(e){this.loginResponse=e.data,this._UserService.registered.next(this.loginResponse.accessToken),this._UserService.userId.next(this.loginResponse.id),this._UserService.userName.next(this.loginResponse.name),this._UserService.role.next(this.loginResponse.roles[0]),this._UserService.image.next(this.loginResponse.image.imageURL),localStorage.setItem("Token",this.loginResponse.accessToken),localStorage.setItem("name",this.loginResponse.name),localStorage.setItem("id",String(this.loginResponse.id)),localStorage.setItem("role",this.loginResponse.roles[0]),localStorage.setItem("image_url",this.loginResponse.image.imageURL),localStorage.setItem("isBanned",this.loginResponse.banned?"true":"false"),this.toastr.success(e.message),this._Router.navigate(["/home"])}handleRememberMe(e){let t=e.target.checked;this.loginForm.get("rememberMe")?.patchValue(t)}googleLogin(){window.open("https://localhost/api/google/login","PopupWindow","width=800,height=600")}receiveMessage(e){if(e.origin!=="https://localhost")return;let t=e.data;t.code===200&&this.handleData(t)}handleLogin(){if(!this.loginForm.valid){this.loginForm.markAllAsTouched();return}this.buttonDisabled=!0,this._UserService.loginData(this.loginForm.value).pipe(x(this.destroy$)).subscribe({next:e=>{if(!e?.data){this.toastr.error("Invalid response from server"),this.buttonDisabled=!1;return}this.handleData(e)},error:e=>{let t=e?.error?.message||"An error occurred while connecting to the server. Please try again later.";this.toastr.error(t)}}).add(()=>{this.buttonDisabled=!1})}static \u0275fac=function(t){return new(t||n)(v(M),v(k),v(F))};static \u0275cmp=I({type:n,selectors:[["app-login"]],decls:22,vars:5,consts:[["email",""],[1,"grid","lg:grid-cols-2","items-center","py-10","gap-10","container"],[1,"flex","justify-center","lg:justify-start"],["src","./assets/images/login-main-pic.jpeg","alt","",1,"w-[450px]","h-[400px]"],[1,"grid","grid-rows-1","gap-6","items-center",3,"ngSubmit","formGroup"],["type","email","placeholder","  Email ...","formControlName","email",1,"engenitic-input"],[4,"ngIf"],["type","password","placeholder","  Password ...","formControlName","password",1,"engenitic-input"],[1,"flex","justify-between"],["type","checkbox","id","remember-me",1,"w-fit","me-5","shadow-none","hover:shadow-none",3,"change","checked"],["for","remember-me",1,"font-display"],["routerLink","/forget-password",1,"font-display","hover:text-[#58B6B8]","transition-colors","duration-300"],[1,"flex","justify-center","gap-8","items-center"],["type","submit",1,"engenitic-button","w-fit","hover:enginitic-main-color","hover:text-white",3,"disabled"],["title","login using gmail","type","button",1,"engenitic-button","w-fit","hover:enginitic-main-color","hover:text-white",3,"click"],[1,"fa-brands","fa-google","px-2","py-1"],["class","text-normal font-regular text-red-500",4,"ngIf"],[1,"text-normal","font-regular","text-red-500"]],template:function(t,i){if(t&1){let o=L();r(0,"main",1)(1,"figure",2),c(2,"img",3),s(),r(3,"form",4),_("ngSubmit",function(){return f(o),h(i.handleLogin())}),c(4,"input",5,0),d(6,W,3,2,"div",6),c(7,"input",7),d(8,K,3,2,"div",6),r(9,"div",8)(10,"div")(11,"input",9),_("change",function(u){return f(o),h(i.handleRememberMe(u))}),s(),r(12,"label",10),m(13,"remember me"),s()(),r(14,"div")(15,"a",11),m(16,"forget password"),s()()(),r(17,"div",12)(18,"button",13),m(19," submit "),s(),r(20,"button",14),_("click",function(){return f(o),h(i.googleLogin())}),c(21,"i",15),s()()()()}if(t&2){let o,p,u,S=C(5);l(3),a("formGroup",i.loginForm),l(3),a("ngIf",((o=i.loginForm.get("email"))==null?null:o.errors)&&(((o=i.loginForm.get("email"))==null?null:o.touched)||S.value.length>0)),l(2),a("ngIf",((p=i.loginForm.get("password"))==null?null:p.errors)&&(((p=i.loginForm.get("password"))==null?null:p.touched)||S.value.length>0)),l(3),a("checked",(u=i.loginForm.get("rememberMe"))==null?null:u.value),l(7),a("disabled",i.buttonDisabled)}},dependencies:[A,$,N,V,j,G,O,E,R,U,T,D],encapsulation:2})};export{P as LoginComponent};
