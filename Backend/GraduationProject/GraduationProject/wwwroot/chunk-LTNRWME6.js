import{a as P,b as h,c as j,d as U,e as b,f as _,h as R,j as $,k as B,l as H,m as J,r as I,t as W}from"./chunk-W3D5FJDG.js";import{l as L}from"./chunk-T3YITE6W.js";import{a as M}from"./chunk-DAENC3M5.js";import{a as O}from"./chunk-CGPJEUNO.js";import{i as G,j as N,r as D}from"./chunk-3CPSLGPY.js";import{Ab as n,Bb as g,Cb as E,Db as q,Eb as C,Ib as f,Jb as c,Q as A,R as y,Tb as d,Vb as Q,Wb as S,Xa as u,a as z,b as F,bb as w,gb as V,ha as v,ia as x,j as T,lb as p,nc as k,sb as a,zb as s}from"./chunk-YOS4OKYA.js";function X(r,t){r&1&&(s(0,"div",28),d(1," Title is required "),n())}function Y(r,t){r&1&&(s(0,"div",28),d(1," Description is required "),n())}function Z(r,t){r&1&&(s(0,"div",28),d(1," Requirements are required "),n())}function ee(r,t){if(r&1){let e=C();s(0,"div",29)(1,"button",30),f("click",function(){v(e);let o=c(2);return x(o.previousLevelCourse())}),d(2," Previous "),n(),s(3,"span"),d(4),n(),s(5,"button",30),f("click",function(){v(e);let o=c(2);return x(o.nextLevelCourse())}),d(6," Next "),n(),s(7,"button",31),f("click",function(){v(e);let o=c(2);return x(o.deleteQuiz())}),d(8," Delete Level "),n()()}if(r&2){let e=c(2);u(),a("disabled",e.currentLevelIndex===0),u(3),S("Level ",e.currentLevelIndex+1," of ",e.quizes.controls.length,""),u(),a("disabled",e.currentLevelIndex===e.quizes.controls.length-1),u(2),a("disabled",e.quizes.controls.length<=1)}}function te(r,t){r&1&&(s(0,"div",28),d(1," Quiz title is required "),n())}function ie(r,t){r&1&&(s(0,"div",28),d(1," videoUrl is required "),n())}function ne(r,t){r&1&&(s(0,"div",28),d(1," description is required "),n())}function re(r,t){if(r&1){let e=C();s(0,"div",42)(1,"button",30),f("click",function(){v(e);let o=c(4);return x(o.previousLevelQuiz())}),d(2," Previous "),n(),s(3,"span"),d(4),n(),s(5,"button",30),f("click",function(){v(e);let o=c(4);return x(o.nextLevelQuiz())}),d(6," Next "),n(),s(7,"button",31),f("click",function(){v(e);let o=c(4);return x(o.deleteQuestion())}),d(8," Delete Question "),n()()}if(r&2){let e=c(4);u(),a("disabled",e.currentQuestionIndex===0),u(3),S("Question ",e.currentQuestionIndex+1," of ",e.questions.controls.length,""),u(),a("disabled",e.currentQuestionIndex===e.questions.controls.length-1),u(2),a("disabled",e.questions.controls.length<=1)}}function oe(r,t){r&1&&(s(0,"div",49),d(1," Please select at least one correct answer for this question "),n())}function se(r,t){r&1&&(s(0,"div",28),d(1," Question text is required "),n())}function le(r,t){r&1&&(s(0,"div",28),d(1," Answer text is required "),n())}function ue(r,t){r&1&&(s(0,"div",49),d(1," Some questions in this quiz are incomplete "),n())}function ae(r,t){if(r&1){let e=C();s(0,"div",50)(1,"div",51)(2,"div",52),g(3,"input",53),p(4,le,2,0,"div",15),n(),s(5,"div",54)(6,"label",55)(7,"input",56),f("click",function(){let o=v(e).index,l=c(2).index,m=c(4);return x(m.setCorrectAnswer(l,o))}),n(),d(8," Correct Answer "),n()(),p(9,ue,2,0,"div",44),n()()}if(r&2){let e,i,o=t.$implicit,l=t.index,m=c(6);a("formGroupName",l),u(4),a("ngIf",((e=m.answers.at(l).get("answerText"))==null?null:e.invalid)&&((e=m.answers.at(l).get("answerText"))==null?null:e.touched)),u(3),a("checked",(i=o.get("isCorrect"))==null?null:i.value),u(2),a("ngIf",m.currentQuiz==null||m.currentQuiz.errors==null?null:m.currentQuiz.errors.invalidQuizzes)}}function de(r,t){if(r&1&&(s(0,"div",33)(1,"div")(2,"label",34),d(3,"Question Text"),n(),g(4,"input",43),p(5,oe,2,0,"div",44)(6,se,2,0,"div",15),n(),s(7,"div",45)(8,"div",46)(9,"h4",47),d(10,"Answers"),n()(),s(11,"div",12),p(12,ae,10,4,"div",48),n()()()),r&2){let e,i=c().index,o=c(2).index,l=c(2);a("formGroupName",i),u(2),a("for","level"+o+"question"+i),u(2),a("id","level"+o+"question"+i),u(),a("ngIf",l.currentQuestion==null||l.currentQuestion.errors==null?null:l.currentQuestion.errors.noCorrectAnswer),u(),a("ngIf",((e=l.currentQuestion.get("questionText"))==null?null:e.invalid)&&((e=l.currentQuestion.get("questionText"))==null?null:e.touched)),u(6),a("ngForOf",l.answers.controls)("ngForTrackBy",l.trackByIndex)}}function ce(r,t){if(r&1&&(E(0),p(1,de,13,7,"div",32),q()),r&2){let e=t.index,i=c(4);u(),a("ngIf",e===i.currentQuestionIndex)}}function me(r,t){if(r&1){let e=C();s(0,"div",33)(1,"div")(2,"label",34),d(3,"Level Title"),n(),g(4,"input",35),p(5,te,2,0,"div",15),n(),s(6,"div")(7,"label",34),d(8,"Video URL"),n(),g(9,"input",36),p(10,ie,2,0,"div",15),n(),s(11,"div")(12,"label",34),d(13,"Description"),n(),g(14,"input",37),p(15,ne,2,0,"div",15),n(),s(16,"div",38)(17,"div",39)(18,"h3",40),d(19,"Questions"),n(),s(20,"button",23),f("click",function(){v(e);let o=c(3);return x(o.addQuestion())}),d(21," Add Question "),n()(),p(22,re,9,5,"div",41)(23,ce,2,1,"ng-container",25),n()()}if(r&2){let e,i,o,l=c().index,m=c(2);a("formGroupName",l),u(2),a("for","quiz"+l+"title"),u(2),a("id","quiz"+l+"title"),u(),a("ngIf",((e=m.currentQuiz.get("title"))==null?null:e.invalid)&&((e=m.currentQuiz.get("title"))==null?null:e.touched)),u(2),a("for","video"+l+"url"),u(2),a("id","video"+l+"url"),u(),a("ngIf",((i=m.currentQuiz.get("videoUrl"))==null?null:i.invalid)&&((i=m.currentQuiz.get("videoUrl"))==null?null:i.touched)),u(2),a("for","description-"+l),u(2),a("id","description-"+l),u(),a("ngIf",((o=m.currentQuiz.get("description"))==null?null:o.invalid)&&((o=m.currentQuiz.get("description"))==null?null:o.touched)),u(7),a("ngIf",m.questions.controls.length>0),u(),a("ngForOf",m.questions.controls)}}function pe(r,t){if(r&1&&(E(0),p(1,me,24,12,"div",32),q()),r&2){let e=t.index,i=c(2);u(),a("ngIf",e===i.currentLevelIndex)}}function _e(r,t){if(r&1){let e=C();s(0,"form",9),f("ngSubmit",function(){v(e);let o=c();return x(o.onSubmitEditCourse())}),s(1,"div",10)(2,"h2",11),d(3,"Course Details"),n(),s(4,"div",12)(5,"div")(6,"label",13),d(7,"Title"),n(),g(8,"input",14),p(9,X,2,0,"div",15),n(),s(10,"div")(11,"label",16),d(12,"Description"),n(),g(13,"textarea",17),p(14,Y,2,0,"div",15),n(),s(15,"div")(16,"label",18),d(17,"Requirements"),n(),g(18,"textarea",19),p(19,Z,2,0,"div",15),n()()(),s(20,"div",20)(21,"div",21)(22,"h2",22),d(23,"Levels"),n(),s(24,"button",23),f("click",function(){v(e);let o=c();return x(o.addQuiz())}),d(25," Add Level "),n()(),p(26,ee,9,5,"div",24)(27,pe,2,1,"ng-container",25),n(),s(28,"div",26)(29,"button",27),d(30," Save Changes "),n()()()}if(r&2){let e,i,o,l=c();a("formGroup",l.courseForm),u(9),a("ngIf",((e=l.courseForm.get("title"))==null?null:e.invalid)&&((e=l.courseForm.get("title"))==null?null:e.touched)),u(5),a("ngIf",((i=l.courseForm.get("description"))==null?null:i.invalid)&&((i=l.courseForm.get("description"))==null?null:i.touched)),u(5),a("ngIf",((o=l.courseForm.get("requirements"))==null?null:o.invalid)&&((o=l.courseForm.get("requirements"))==null?null:o.touched)),u(7),a("ngIf",l.quizes.controls.length>0),u(),a("ngForOf",l.quizes.controls)}}function fe(r,t){if(r&1&&(s(0,"p",57),d(1),n()),r&2){let e=c();u(),Q(" ",e.fileValidationError," ")}}var K=class r{constructor(t,e,i,o){this.cd=t;this.coursesService=e;this.toastr=i;this.route=o}courseForm;currentLevelIndex=0;currentQuestionIndex=0;courseData;courseId;instructorId;destroy$=new T;selectedFile=null;fileValidationError=null;ngOnInit(){this.route.paramMap.pipe(y(this.destroy$),A(t=>(this.instructorId=Number(t.get("instructorId")),this.courseId=Number(t.get("courseId")),this.coursesService.getCourseWithQuizzes(this.courseId)))).subscribe({next:t=>{this.courseData=t.data,this.initializeForm(),this.cd.detectChanges()},error:t=>this.handleError(t)})}initializeForm(){this.courseForm=new b({title:new _(this.courseData?.title||"",h.required),description:new _(this.courseData?.description||"",h.required),requirements:new _(this.courseData?.requirements||"",h.required),quizes:new I(this.courseData?.quizes?.map(t=>this.createQuizGroup(t))||[],[this.validateQuizzes])})}addQuiz(){this.quizes.push(this.createQuizGroup({id:0,title:"",position:this.quizes.length+1,description:"",videoUrl:null,questions:[this.createDefaultQuestion()]})),this.currentLevelIndex=this.quizes.length-1,this.currentQuestionIndex=this.questions.length-1}createDefaultQuestion(){return{id:0,questionText:"",position:1,answers:Array(4).fill(null).map((t,e)=>({id:0,answerText:"",position:e+1,isCorrect:!1}))}}createQuizGroup(t){return new b({id:new _(t?.id||0),title:new _(t?.title||"",h.required),position:new _(t?.position||this.quizes.length+1,h.required),videoUrl:new _(t?.videoUrl||null),description:new _(t?.description||""),questions:new I(t?.questions?.map(e=>this.createQuestionGroup(e))||[])})}addQuestion(){this.questions.push(this.createQuestionGroup()),this.currentQuestionIndex=this.questions.length-1}createQuestionGroup(t){return new b({id:new _(t?.id||0),questionText:new _(t?.questionText||"",h.required),position:new _(t?.position||this.questions.length+1),answers:new I(t?.answers?.map(e=>this.createAnswerGroup(e))||this.createEmptyAnswers())},{validators:this.atLeastOneCorrectAnswerValidator})}createEmptyAnswers(){return Array(4).fill(null).map((t,e)=>this.createAnswerGroup({id:0,answerText:"",position:e+1,isCorrect:!1}))}createAnswerGroup(t){return new b({id:new _(t?.id||0),answerText:new _(t?.answerText||"",h.required),position:new _(t?.position||0),isCorrect:new _(t?.isCorrect||!1)})}get quizes(){return this.courseForm.get("quizes")}get currentQuiz(){return this.quizes.at(this.currentLevelIndex)}get questions(){return this.currentQuiz.get("questions")}get currentQuestion(){return this.questions.at(this.currentQuestionIndex)}get answers(){return this.currentQuestion.get("answers")}deleteQuiz(){this.quizes.length>0&&(this.quizes.removeAt(this.currentLevelIndex),this.quizes.controls.forEach((t,e)=>{t.get("position")?.setValue(e+1)}),this.currentLevelIndex=Math.max(0,this.currentLevelIndex-1)),this.currentQuestionIndex=this.questions.length-1}deleteQuestion(){this.questions.length>0&&(this.questions.removeAt(this.currentQuestionIndex),this.questions.controls.forEach((t,e)=>{t.get("position")?.setValue(e+1)})),this.currentQuestionIndex=Math.max(0,this.currentQuestionIndex-1)}previousLevelCourse(){this.currentLevelIndex>0&&this.currentLevelIndex--,this.currentQuestionIndex=this.questions.length-1}nextLevelCourse(){this.currentLevelIndex<this.quizes.length-1&&this.currentLevelIndex++,this.currentQuestionIndex=this.questions.length-1}previousLevelQuiz(){this.currentQuestionIndex>0&&this.currentQuestionIndex--}nextLevelQuiz(){this.currentQuestionIndex<this.questions.length-1&&this.currentQuestionIndex++}setCorrectAnswer(t,e){let i=this.questions.at(t);if(!i)return;i.get("answers").controls.forEach((l,m)=>{l.get("isCorrect")?.setValue(m===e)}),i.updateValueAndValidity()}atLeastOneCorrectAnswerValidator=t=>t.get("answers")?.controls.some(o=>o.get("isCorrect")?.value)?null:{noCorrectAnswer:!0};validateQuizzes(t){return t.controls.some(o=>o.get("questions").controls.some(m=>m.invalid))?{invalidQuizzes:!0}:null}markAllAsTouched(t){Object.values(t.controls).forEach(e=>{e instanceof b||e instanceof I?this.markAllAsTouched(e):e.markAsTouched()})}handleError(t){this.toastr.error(t.message||"An error occurred")}trackByIndex(t){return t}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onSubmitEditCourse(){if(this.courseForm.invalid){this.markAllAsTouched(this.courseForm),this.toastr.error("Please fill all required fields");return}let t=structuredClone(this.courseForm.value),e=F(z({},t),{id:this.courseId,instructorId:this.instructorId||0,tags:this.courseData?.tags||[],code:this.courseData?.code||""});console.log(e),this.coursesService.editCourse(e).pipe(y(this.destroy$)).subscribe({next:i=>{console.log(i),this.toastr.success(i.message)},error:i=>{console.warn(i),i.error?this.toastr.error(i.error.message):this.toastr.error(i)}})}onFileChange(t){let e=t.target;if(this.fileValidationError=null,e.files?.length){let i=e.files[0],o=["image/jpg","image/png","image/jpeg"],l=2*1024*1024;if(!o.includes(i.type)){this.fileValidationError="Invalid image type (only JPG/PNG allowed)";return}if(i.size>l){this.fileValidationError="Image size must be less than 2MB";return}this.selectedFile=i}}onSubmitEditImage(t){t.preventDefault();let e=new FormData;this.selectedFile?(e.append("image",this.selectedFile),e.append("courseId",String(this.courseId)),e.append("instructorId",String(this.instructorId)),this.coursesService.editCourseImage(e).pipe(y(this.destroy$)).subscribe({next:i=>{console.log(i),this.toastr.success(i.message)},error:i=>{console.warn(i),i.error?this.toastr.error(i.error.message):this.toastr.error(i)}})):this.fileValidationError="image field is required"}static \u0275fac=function(e){return new(e||r)(w(k),w(M),w(L),w(O))};static \u0275cmp=V({type:r,selectors:[["app-instructor-edit-course"]],decls:12,vars:3,consts:[[1,"container","mx-auto","p-6"],[1,"text-2xl","sm:text-3xl","lg:text-5xl","font-display","font-bold","mb-6"],["class","space-y-8",3,"formGroup","ngSubmit",4,"ngIf"],[1,"my-10"],[1,"form-group"],["for","imageUrl"],["id","imageUrl","type","file","accept","image/*",1,"mb-3","custom-file-input","font-display","lowercase",3,"change"],["class","text-red-500",4,"ngIf"],["type","submit",1,"bg-green-500","text-white","px-6","py-3","rounded-md","hover:bg-green-600","font-regular",3,"click"],[1,"space-y-8",3,"ngSubmit","formGroup"],[1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"text-2xl","font-semibold","mb-4"],[1,"space-y-4"],["for","title",1,"block","text-sm","font-medium","mb-1"],["id","title","type","text","formControlName","title",1,"w-full","p-2","border","rounded-md"],["class","text-red-500 text-sm mt-1",4,"ngIf"],["for","description",1,"block","text-sm","font-medium","mb-1"],["title","description","formControlName","description",1,"w-full","p-2","border","rounded-md","h-32"],["for","requirements",1,"block","text-sm","font-medium","mb-1"],["id","requirements","formControlName","requirements",1,"w-full","p-2","border","rounded-md","h-32"],["formArrayName","quizes",1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-semibold"],["type","button",1,"bg-blue-500","text-white","px-4","py-2","rounded-md","hover:bg-blue-600",3,"click"],["class","mb-6 flex md:items-center md:flex-row flex-col gap-4",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"mt-8","md:mx-0"],["type","submit",1,"bg-green-500","text-white","px-6","py-3","rounded-md","hover:bg-green-600","font-regular"],[1,"text-red-500","text-sm","mt-1"],[1,"mb-6","flex","md:items-center","md:flex-row","flex-col","gap-4"],["type","button",1,"bg-blue-500","text-white","px-4","py-2","rounded-md","hover:bg-blue-600",3,"click","disabled"],["type","button",1,"bg-red-500","text-white","px-4","py-2","rounded-md","hover:bg-red-600",3,"click","disabled"],["class","space-y-4",3,"formGroupName",4,"ngIf"],[1,"space-y-4",3,"formGroupName"],[1,"block","text-sm","font-medium","mb-1",3,"for"],["type","text","formControlName","title",1,"w-full","p-2","border","rounded-md",3,"id"],["type","url","formControlName","videoUrl",1,"w-full","p-2","border","rounded-md",3,"id"],["type","text","formControlName","description",1,"w-full","p-2","border","rounded-md",3,"id"],["formArrayName","questions",1,"mt-6"],[1,"flex","justify-between","items-center","flex-row","mb-6"],[1,"text-xl","font-semibold"],["class","mb-6 flex md:items-center flex-col md:flex-row gap-4",4,"ngIf"],[1,"mb-6","flex","md:items-center","flex-col","md:flex-row","gap-4"],["type","text","formControlName","questionText",1,"w-full","p-2","border","rounded-md",3,"id"],["class","text-red-500 mt-2",4,"ngIf"],["formArrayName","answers",1,"mt-4"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","font-medium"],["class","border p-4 rounded-md",3,"formGroupName",4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-red-500","mt-2"],[1,"border","p-4","rounded-md",3,"formGroupName"],[1,"flex","md:items-center","flex-col","md:flex-row","gap-4"],[1,"flex-1"],["type","text","formControlName","answerText","placeholder","Answer text",1,"w-full","p-2","border","rounded-md"],[1,"flex","items-center","gap-2"],[1,"text-sm"],["title","is answer correct?","type","radio",1,"radio-input",3,"click","checked"],[1,"text-red-500"]],template:function(e,i){e&1&&(s(0,"main",0)(1,"h1",1),d(2),n(),p(3,_e,31,6,"form",2),s(4,"form",3)(5,"div",4)(6,"label",5),d(7,"Course Image"),n(),s(8,"input",6),f("change",function(l){return i.onFileChange(l)}),n(),p(9,fe,2,1,"p",7),n(),s(10,"button",8),f("click",function(l){return i.onSubmitEditImage(l)}),d(11," submit image "),n()()()),e&2&&(u(2),Q(" Edit Course: ",(i.courseData==null?null:i.courseData.title)||"Loading..."," "),u(),a("ngIf",i.courseForm),u(6),a("ngIf",i.fileValidationError))},dependencies:[W,R,P,j,U,$,J,B,H,D,G,N],styles:[".form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:600;color:#333}.error[_ngcontent-%COMP%]{color:#dc2626;font-size:.875rem;margin-top:.25rem}input[type=text][_ngcontent-%COMP%], input[type=url][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #ddd;border-radius:4px;font-size:1rem}textarea[_ngcontent-%COMP%]{min-height:100px;resize:vertical}button[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:4px;transition:background-color .2s}.btn-primary[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.btn-secondary[_ngcontent-%COMP%]{background-color:#6b7280;color:#fff;margin-right:.5rem}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#4b5563}.level-navigation[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin:1rem 0}.level-indicator[_ngcontent-%COMP%]{font-weight:600;color:#4b5563}.error-message[_ngcontent-%COMP%]{color:#dc2626;font-size:.875rem;margin-top:.25rem}.preview-image[_ngcontent-%COMP%]{max-width:200px;margin-top:1rem;border-radius:4px}.radio-input[_ngcontent-%COMP%]{box-shadow:none!important;border:none;margin-right:.5rem;accent-color:#2563eb}button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}"]})};export{K as InstructorEditCourseComponent};
