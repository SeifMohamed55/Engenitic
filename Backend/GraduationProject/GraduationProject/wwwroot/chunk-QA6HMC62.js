import{a as $}from"./chunk-KCRSIWVY.js";import{a as k,b as g,c as M,d as j,e as I,f as E,h as R,j as z,m as L,t as J}from"./chunk-W3D5FJDG.js";import{l as O}from"./chunk-T3YITE6W.js";import{b as A,g as G}from"./chunk-CGPJEUNO.js";import{h as B,j as q,r as D}from"./chunk-3CPSLGPY.js";import{Ab as s,Bb as f,Eb as T,Ib as _,Jb as v,R as c,Sa as x,Sb as b,Tb as d,Vb as V,Xa as o,ac as S,bb as y,gb as U,ha as h,ia as w,j as C,lb as u,sb as a,zb as n}from"./chunk-YOS4OKYA.js";var N=r=>({"engenitic-button-disabled":r});function X(r,t){r&1&&(n(0,"p",29),d(1," Invalid email format "),s())}function Z(r,t){r&1&&(n(0,"p",29),d(1," Email field is required "),s())}function ee(r,t){if(r&1&&(n(0,"div",27),u(1,X,2,0,"p",28)(2,Z,2,0,"p",28),s()),r&2){let i,e,l=v();o(),a("ngIf",(i=l.emailForm.get("email"))==null?null:i.getError("email")),o(),a("ngIf",(e=l.emailForm.get("email"))==null?null:e.getError("required"))}}function te(r,t){r&1&&(n(0,"p",29),d(1," Username field is required "),s())}function re(r,t){if(r&1&&(n(0,"div",27),u(1,te,2,0,"p",28),s()),r&2){let i,e=v();o(),a("ngIf",(i=e.userNameForm.get("userName"))==null?null:i.getError("required"))}}function ie(r,t){if(r&1&&(n(0,"p",30),d(1),s()),r&2){let i=v();o(),V(" ",i.fileValidationError," ")}}function ne(r,t){r&1&&(n(0,"p",29),d(1," Current password is required "),s())}function se(r,t){r&1&&(n(0,"p",29),d(1," Password must be at least 6 characters "),s())}function oe(r,t){if(r&1&&(n(0,"div",27),u(1,ne,2,0,"p",28)(2,se,2,0,"p",28),s()),r&2){let i,e,l=v();o(),a("ngIf",(i=l.passwordForm.get("oldPassword"))==null?null:i.getError("required")),o(),a("ngIf",(e=l.passwordForm.get("oldPassword"))==null?null:e.getError("minlength"))}}function ae(r,t){r&1&&(n(0,"p",29),d(1," New password is required "),s())}function le(r,t){r&1&&(n(0,"p",29),d(1," Password must be at least 6 characters "),s())}function me(r,t){if(r&1&&(n(0,"div",27),u(1,ae,2,0,"p",28)(2,le,2,0,"p",28),s()),r&2){let i,e,l=v();o(),a("ngIf",(i=l.passwordForm.get("newPassword"))==null?null:i.getError("required")),o(),a("ngIf",(e=l.passwordForm.get("newPassword"))==null?null:e.getError("minlength"))}}function de(r,t){r&1&&(n(0,"div",31)(1,"p",32),d(2," New password must be different from current password "),s()())}var H=class r{constructor(t,i){this._UserService=t;this._ToastrService=i}destroy$=new C;userId=0;userEmail="";userName="";userImage={name:"",Url:""};disableButtonEmail=!0;disableButtonUserName=!0;disableButtonImage=!0;disableButtonPassword=!1;selectedFile=null;previewUrl=null;fileValidationError=null;newEmail="";newUserName="";emailForm=new I({email:new E(this.userEmail,[g.required,g.email])});userNameForm=new I({userName:new E(this.userName,[g.required])});passwordForm=new I({oldPassword:new E("",[g.required,g.minLength(5)]),newPassword:new E("",[g.required,g.minLength(5)])},{validators:[this.passwordValidation]});ngOnInit(){typeof window<"u"&&localStorage&&(this.userId=parseInt(localStorage.getItem("id"))||0,this.userName=localStorage.getItem("name")||"",this.previewUrl=localStorage.getItem("image_url")||"",this.userImage.Url=localStorage.getItem("image_url")||""),this.initiateForms(),this.emailForm.get("email")?.valueChanges.pipe(c(this.destroy$)).subscribe(t=>{this.newEmail=t||"",this.disableButtonEmail=!t||t===this.userEmail}),this.userNameForm.get("userName")?.valueChanges.pipe(c(this.destroy$)).subscribe(t=>{this.newUserName=t||"",this.disableButtonUserName=!t||t===this.userName})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initiateForms(){this._UserService.getProfileData(this.userId).pipe(c(this.destroy$)).subscribe({next:t=>{console.log(t),this.userImage.name=t.data.image.name,this.userEmail=t.data.email,this.emailForm.patchValue({email:this.userEmail}),this.userNameForm.patchValue({userName:this.userName}),this.passwordForm.reset()},error:t=>{this._ToastrService.error(t.error?.message||"An error occurred.")}})}onFileChange(t){let i=t.target;this.fileValidationError=null,this.disableButtonImage=!0;let e=["image/jpg","image/png","image/jpeg"],l=2*1024*1024;if(i.files&&i.files.length>0){let m=i.files[0];if(m.name===this.userImage.name){this.fileValidationError="No changes detected! Your profile picture remains the same.";return}if(!e.includes(m.type)){this.fileValidationError="Invalid image type. Only JPG, PNG, and JPEG are allowed.";return}if(m.size>l){this.fileValidationError="Image size must be less than 2MB.";return}this.selectedFile=m;let p=new FileReader;p.readAsDataURL(m),p.onload=()=>{this.previewUrl=p.result,this.disableButtonImage=!1}}else this.selectedFile=null,this.previewUrl=null}passwordValidation(t){let i=t.get("oldPassword")?.value,e=t.get("newPassword")?.value;return i===e?{samePassword:!0}:null}handleEmailSubmit(){this.emailForm.valid?this._UserService.updateEmail(this.userId,this.newEmail).pipe(c(this.destroy$)).subscribe({next:t=>{this._ToastrService.success(t.message),this.userEmail=this.newEmail,this.emailForm.patchValue({email:this.newEmail}),this.disableButtonEmail=!0},error:t=>{console.error(t)}}):this.emailForm.markAllAsTouched()}handleUserNameSubmit(){this.userNameForm.valid?this._UserService.updateUserName(this.userId,this.newUserName).pipe(c(this.destroy$)).subscribe({next:t=>{this._ToastrService.success(t.message),this.userName=this.newUserName,this._UserService.userName.next(this.newUserName),localStorage.setItem("name",this.newUserName),this.disableButtonUserName=!0},error:t=>{console.error(t)}}):this.userNameForm.markAllAsTouched()}handleImageSubmit(){if(!this.selectedFile)return;let t=new FormData;t.append("image",this.selectedFile),t.append("id",`${this.userId}`),this._UserService.updateImage(t).pipe(c(this.destroy$)).subscribe({next:i=>{this._ToastrService.success(i.message),this.userImage.name=this.selectedFile.name,this.userImage.Url=this.previewUrl,this._UserService.image.next(this.previewUrl),localStorage.setItem("image_url",this.previewUrl),this.disableButtonImage=!0},error:i=>{i.error?this._ToastrService.error(i.error.message):this._ToastrService.error("an error happened to the server try again later")}})}handlePasswordSubmit(){if(this.passwordForm.valid){let{oldPassword:t,newPassword:i}=this.passwordForm.value;this._UserService.updatePassword(this.userId,t,i).pipe(c(this.destroy$)).subscribe({next:e=>{this._ToastrService.success(e.message)},error:e=>{e.error.message?this._ToastrService.error(e.error.message[0].description):console.log(e)}})}else this.passwordForm.markAllAsTouched()}static \u0275fac=function(i){return new(i||r)(y($),y(O))};static \u0275cmp=U({type:r,selectors:[["app-profile"]],decls:41,vars:26,consts:[["email",""],["userName",""],["oldPassword",""],["newPassword",""],[1,"container","pt-10"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","lg:gap-20"],[1,"w-full",3,"ngSubmit","formGroup"],[1,"form-group"],["type","email","placeholder","Email","formControlName","email",1,"engenitic-input","w-full"],["class","error-messages",4,"ngIf"],["type","submit",1,"engenitic-button","w-full","sm:w-auto","hover:bg-yellow-500","duration-500","transition-all","mt-4",3,"ngClass","disabled"],["type","text","placeholder","Username","formControlName","userName",1,"engenitic-input","w-full"],[1,"lg:col-span-2","w-full","max-w-[300px]","mx-auto","flex","flex-col","items-center","mb-8"],[1,"profile-picture-container"],["alt","Profile picture",1,"w-[200px]","h-[200px]","object-cover","rounded-full","border-4","border-gray-200",3,"src"],[1,"file-input-container","mt-4","w-full"],["type","file","accept","image/*","id","fileInput","title","update image button",1,"custom-file-input","w-full","text-center",3,"change"],["class","text-sm text-center font-regular text-red-500 mt-2",4,"ngIf"],["type","button",1,"engenitic-button","w-full","sm:w-auto","hover:bg-yellow-500","duration-500","transition-all","mt-4",3,"click","ngClass","disabled"],[1,"lg:col-span-2","w-full"],[1,"password-form",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","lg:gap-8"],["type","password","placeholder","Current Password","formControlName","oldPassword",1,"engenitic-input","w-full"],["type","password","placeholder","New Password","formControlName","newPassword",1,"engenitic-input","w-full"],["class","text-center mt-4",4,"ngIf"],[1,"text-center","mt-6"],["type","submit",1,"engenitic-button","w-full","sm:w-auto","hover:bg-yellow-500","duration-500","transition-all",3,"ngClass","disabled"],[1,"error-messages"],["class","text-sm font-regular text-red-500 mt-2",4,"ngIf"],[1,"text-sm","font-regular","text-red-500","mt-2"],[1,"text-sm","text-center","font-regular","text-red-500","mt-2"],[1,"text-center","mt-4"],[1,"text-sm","font-regular","text-red-500"]],template:function(i,e){if(i&1){let l=T();n(0,"main",4)(1,"div",5)(2,"form",6),_("ngSubmit",function(){return h(l),w(e.handleEmailSubmit())}),n(3,"div",7),f(4,"input",8,0),u(6,ee,3,2,"div",9),s(),n(7,"button",10),d(8," Update Email "),s()(),n(9,"form",6),_("ngSubmit",function(){return h(l),w(e.handleUserNameSubmit())}),n(10,"div",7),f(11,"input",11,1),u(13,re,2,1,"div",9),s(),n(14,"button",10),d(15," Update Username "),s()(),n(16,"div",12)(17,"div",13),f(18,"img",14),s(),n(19,"div",15)(20,"input",16),_("change",function(p){return h(l),w(e.onFileChange(p))}),s()(),u(21,ie,2,1,"p",17),n(22,"button",18),_("click",function(){return h(l),w(e.handleImageSubmit())}),d(23," Update Picture "),s()(),n(24,"div",19)(25,"form",20),_("ngSubmit",function(){return h(l),w(e.handlePasswordSubmit())}),n(26,"div",21)(27,"div",7),f(28,"input",22,2),u(30,oe,3,2,"div",9),s(),n(31,"div",7),f(32,"input",23,3),u(34,me,3,2,"div",9),s()(),u(35,de,3,0,"div",24),n(36,"div",25)(37,"button",26),d(38," Update Password "),s()()()()(),n(39,"section"),f(40,"router-outlet"),s()()}if(i&2){let l,m,p,P,F,Y=b(5),K=b(12),Q=b(29),W=b(33);o(2),a("formGroup",e.emailForm),o(4),a("ngIf",((l=e.emailForm.get("email"))==null?null:l.errors)&&(((l=e.emailForm.get("email"))==null?null:l.touched)||Y.value.length>0)),o(),a("ngClass",S(18,N,e.disableButtonEmail))("disabled",e.disableButtonEmail),o(2),a("formGroup",e.userNameForm),o(4),a("ngIf",((m=e.userNameForm.get("userName"))==null?null:m.errors)&&(((m=e.userNameForm.get("userName"))==null?null:m.touched)||K.value.length>0)),o(),a("ngClass",S(20,N,e.disableButtonUserName))("disabled",e.disableButtonUserName),o(4),a("src",e.previewUrl,x),o(3),a("ngIf",e.fileValidationError),o(),a("ngClass",S(22,N,e.disableButtonImage))("disabled",e.disableButtonImage),o(3),a("formGroup",e.passwordForm),o(5),a("ngIf",((p=e.passwordForm.get("oldPassword"))==null?null:p.errors)&&(((p=e.passwordForm.get("oldPassword"))==null?null:p.touched)||Q.value.length>0)),o(4),a("ngIf",((P=e.passwordForm.get("newPassword"))==null?null:P.errors)&&(((P=e.passwordForm.get("newPassword"))==null?null:P.touched)||W.value.length>0)),o(),a("ngIf",(e.passwordForm.errors==null?null:e.passwordForm.errors.samePassword)&&!((F=e.passwordForm.get("oldPassword"))!=null&&F.errors)&&!((F=e.passwordForm.get("newPassword"))!=null&&F.errors)),o(2),a("ngClass",S(24,N,e.disableButtonPassword))("disabled",e.disableButtonPassword)}},dependencies:[J,R,k,M,j,z,L,D,B,q,G,A],encapsulation:2})};export{H as ProfileComponent};
